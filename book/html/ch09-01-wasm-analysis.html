<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Chapter 9: WASM Analysis - Ruchy REPL &amp; One-Liner Demos</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Test-driven collection of Ruchy REPL sessions and one-liners - every example is tested">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="book/theme/ruchy.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "rust";
            const default_dark_theme = "coal";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>‚Üê</kbd> or <kbd>‚Üí</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Ruchy REPL &amp; One-Liner Demos</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/paiml/ruchy-repl-demos" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/paiml/ruchy-repl-demos/edit/main/book/src/ch09-01-wasm-analysis.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="91-webassembly-analysis-and-notebook-integration"><a class="header" href="#91-webassembly-analysis-and-notebook-integration">9.1 WebAssembly Analysis and Notebook Integration</a></h1>
<p><strong>Advanced Code Analysis: WebAssembly Module Quality Assessment</strong></p>
<p>WebAssembly (WASM) represents the future of high-performance web applications and cross-platform computing. With WASM modules becoming increasingly complex, understanding their quality, security, and performance characteristics is crucial for production deployment.</p>
<p>This chapter demonstrates how to analyze WASM code using professional analysis tools and integrate with notebook environments for interactive exploration.</p>
<h2 id="what-youll-learn"><a class="header" href="#what-youll-learn">What You‚Äôll Learn</a></h2>
<ul>
<li>WebAssembly binary and text format analysis</li>
<li>AssemblyScript source code quality assessment</li>
<li>Security validation for WASM modules</li>
<li>Integration with interactive notebook environments</li>
<li>Performance profiling and optimization techniques</li>
</ul>
<h2 id="wasm-analysis-fundamentals"><a class="header" href="#wasm-analysis-fundamentals">WASM Analysis Fundamentals</a></h2>
<h3 id="understanding-wasm-formats"><a class="header" href="#understanding-wasm-formats">Understanding WASM Formats</a></h3>
<pre><code class="language-ruchy">// Different WASM formats we can analyze
let wasm_formats = [
    {format: "wasm", description: "Binary format - compiled modules", extension: ".wasm"},
    {format: "wat", description: "Text format - human readable", extension: ".wat"},
    {format: "as", description: "AssemblyScript source", extension: ".as"}
];

println("WASM Analysis Formats:");
for format in wasm_formats {
    println(f"‚Ä¢ {format.format.upper()}: {format.description} ({format.extension})");
}
</code></pre>
<h3 id="basic-wasm-module-structure"><a class="header" href="#basic-wasm-module-structure">Basic WASM Module Structure</a></h3>
<pre><code class="language-ruchy">// Analyzing a simple WASM module structure
let wasm_module = {
    magic: "0x6d736100",  // WASM magic number
    version: "0x01000000", // Version 1
    sections: [
        "type",      // Function signatures
        "import",    // External dependencies  
        "function",  // Function declarations
        "table",     // Function tables
        "memory",    // Memory layout
        "global",    // Global variables
        "export",    // Exported functions
        "start",     // Start function
        "element",   // Table elements
        "code",      // Function bodies
        "data"       // Memory initialization
    ]
};

println("WASM Module Sections:");
for section in wasm_module.sections {
    println(f"‚Ä¢ {section} section");
}
</code></pre>
<h2 id="assemblyscript-analysis"><a class="header" href="#assemblyscript-analysis">AssemblyScript Analysis</a></h2>
<p>AssemblyScript compiles to WebAssembly while maintaining TypeScript-like syntax:</p>
<pre><code class="language-ruchy">// Sample AssemblyScript code analysis
let assemblyscript_sample = `
export function fibonacci(n: i32): i32 {
    if (n &lt;= 1) return n;
    let a: i32 = 0, b: i32 = 1;
    for (let i: i32 = 2; i &lt;= n; i++) {
        let temp: i32 = a + b;
        a = b;
        b = temp;
    }
    return b;
}

@inline
function fastMultiply(a: i32, b: i32): i32 {
    return a * b;  // Will be inlined by compiler
}

export class Calculator {
    private value: i32 = 0;
    
    add(n: i32): Calculator {
        this.value += n;
        return this;
    }
    
    multiply(n: i32): Calculator {
        this.value = fastMultiply(this.value, n);
        return this;
    }
    
    getValue(): i32 {
        return this.value;
    }
}`;

// Analyze complexity characteristics
let analysis_result = {
    functions: 4,  // fibonacci, fastMultiply, add, multiply, getValue
    classes: 1,    // Calculator
    cyclomatic_complexity: 3,  // fibonacci has 2, others have 1
    cognitive_complexity: 4,   // fibonacci loop adds complexity
    memory_pressure: 0.2,      // Low memory usage
    inline_functions: 1,       // fastMultiply marked @inline
    exports: 2,               // fibonacci and Calculator
    type_annotations: 8       // Strong typing throughout
};

println("AssemblyScript Analysis:");
println(f"‚Ä¢ Functions: {analysis_result.functions}");
println(f"‚Ä¢ Classes: {analysis_result.classes}");
println(f"‚Ä¢ Cyclomatic Complexity: {analysis_result.cyclomatic_complexity}");
println(f"‚Ä¢ Cognitive Complexity: {analysis_result.cognitive_complexity}");
println(f"‚Ä¢ Memory Pressure: {analysis_result.memory_pressure}");
println(f"‚Ä¢ Inline Functions: {analysis_result.inline_functions}");
println(f"‚Ä¢ Exports: {analysis_result.exports}");
</code></pre>
<h2 id="wasm-binary-analysis"><a class="header" href="#wasm-binary-analysis">WASM Binary Analysis</a></h2>
<pre><code class="language-ruchy">// Simulated WASM binary analysis (normally done with actual .wasm files)
fun analyze_wasm_binary(module_path: String) -&gt; WasmMetrics {
    // In production, this would parse actual WASM binary format
    let metrics = {
        file_size_kb: 45.2,
        function_count: 12,
        import_count: 3,
        export_count: 5,
        linear_memory_pages: 2,  // 64KB pages
        table_count: 1,
        global_count: 4,
        data_segments: 2,
        code_size_kb: 38.1,
        data_size_kb: 7.1,
        start_function: true,
        custom_sections: ["name", "sourceMappingURL"]
    };
    
    return metrics;
}

// Analyze a sample WASM module
let sample_metrics = analyze_wasm_binary("calculator.wasm");

println("WASM Binary Metrics:");
println(f"‚Ä¢ File size: {sample_metrics.file_size_kb}KB");
println(f"‚Ä¢ Functions: {sample_metrics.function_count}");
println(f"‚Ä¢ Imports: {sample_metrics.import_count}");
println(f"‚Ä¢ Exports: {sample_metrics.export_count}");
println(f"‚Ä¢ Memory pages: {sample_metrics.linear_memory_pages} ({sample_metrics.linear_memory_pages * 64}KB)");
println(f"‚Ä¢ Tables: {sample_metrics.table_count}");
println(f"‚Ä¢ Globals: {sample_metrics.global_count}");
println(f"‚Ä¢ Code section: {sample_metrics.code_size_kb}KB");
println(f"‚Ä¢ Data section: {sample_metrics.data_size_kb}KB");
</code></pre>
<h2 id="security-analysis"><a class="header" href="#security-analysis">Security Analysis</a></h2>
<pre><code class="language-ruchy">// WASM security validation framework
struct WasmSecurityCheck {
    check_name: String,
    severity: String,  // "low", "medium", "high", "critical"
    description: String,
    passed: Bool
}

fun analyze_wasm_security(module_metrics: WasmMetrics) -&gt; Vec&lt;WasmSecurityCheck&gt; {
    let mut security_checks = Vec::new();
    
    // Memory safety checks
    security_checks.push(WasmSecurityCheck {
        check_name: "Memory bounds".to_string(),
        severity: "high".to_string(),
        description: "Verify memory access is within allocated pages".to_string(),
        passed: module_metrics.linear_memory_pages &gt; 0 &amp;&amp; module_metrics.linear_memory_pages &lt;= 32
    });
    
    // Import validation
    security_checks.push(WasmSecurityCheck {
        check_name: "Import validation".to_string(),
        severity: "medium".to_string(),
        description: "Check for suspicious external dependencies".to_string(),
        passed: module_metrics.import_count &lt;= 10
    });
    
    // Code size validation
    security_checks.push(WasmSecurityCheck {
        check_name: "Code size limit".to_string(),
        severity: "low".to_string(),
        description: "Ensure module isn't suspiciously large".to_string(),
        passed: module_metrics.code_size_kb &lt;= 1024.0  // 1MB limit
    });
    
    // Export surface area
    security_checks.push(WasmSecurityCheck {
        check_name: "Export surface".to_string(),
        severity: "medium".to_string(),
        description: "Minimize exported function attack surface".to_string(),
        passed: module_metrics.export_count &lt;= 20
    });
    
    return security_checks;
}

// Run security analysis
let security_results = analyze_wasm_security(sample_metrics);

println("Security Analysis Results:");
for check in security_results {
    let status = if check.passed { "‚úÖ PASS" } else { "‚ùå FAIL" };
    let severity_indicator = match check.severity.as_str() {
        "low" =&gt; "üü¢",
        "medium" =&gt; "üü°", 
        "high" =&gt; "üü†",
        "critical" =&gt; "üî¥",
        _ =&gt; "‚ö™"
    };
    
    println(f"{severity_indicator} [{check.severity.upper()}] {check.check_name}: {status}");
    println(f"   {check.description}");
}
</code></pre>
<h2 id="performance-analysis"><a class="header" href="#performance-analysis">Performance Analysis</a></h2>
<pre><code class="language-ruchy">// WASM performance characteristics analysis
struct WasmPerformanceMetrics {
    estimated_load_time_ms: f64,
    compilation_complexity: String,
    memory_efficiency: f64,
    function_call_overhead: String,
    optimization_opportunities: Vec&lt;String&gt;
}

fun analyze_wasm_performance(metrics: WasmMetrics) -&gt; WasmPerformanceMetrics {
    // Estimate load time based on file size (rough approximation)
    let estimated_load_time = metrics.file_size_kb * 0.1;  // ~0.1ms per KB
    
    // Compilation complexity based on function count
    let compilation_complexity = if metrics.function_count &lt;= 10 {
        "Low"
    } else if metrics.function_count &lt;= 50 {
        "Medium"
    } else {
        "High"
    }.to_string();
    
    // Memory efficiency: code/data ratio
    let memory_efficiency = if metrics.data_size_kb &gt; 0.0 {
        metrics.code_size_kb / metrics.data_size_kb
    } else {
        metrics.code_size_kb
    };
    
    // Function call overhead assessment
    let function_call_overhead = if metrics.function_count &gt; 100 {
        "High - Consider function inlining"
    } else if metrics.function_count &gt; 50 {
        "Medium - Monitor call patterns"  
    } else {
        "Low - Acceptable overhead"
    }.to_string();
    
    // Optimization opportunities
    let mut optimizations = Vec::new();
    if metrics.data_size_kb &gt; metrics.code_size_kb {
        optimizations.push("Consider data compression".to_string());
    }
    if metrics.linear_memory_pages &gt; 4 {
        optimizations.push("Evaluate memory usage patterns".to_string());
    }
    if metrics.import_count &gt; 5 {
        optimizations.push("Reduce external dependencies".to_string());
    }
    
    WasmPerformanceMetrics {
        estimated_load_time_ms: estimated_load_time,
        compilation_complexity,
        memory_efficiency,
        function_call_overhead,
        optimization_opportunities: optimizations
    }
}

// Analyze performance
let perf_analysis = analyze_wasm_performance(sample_metrics);

println("Performance Analysis:");
println(f"‚Ä¢ Estimated load time: {perf_analysis.estimated_load_time_ms:.1}ms");
println(f"‚Ä¢ Compilation complexity: {perf_analysis.compilation_complexity}");
println(f"‚Ä¢ Memory efficiency ratio: {perf_analysis.memory_efficiency:.1}");
println(f"‚Ä¢ Function call overhead: {perf_analysis.function_call_overhead}");
println("\nOptimization Opportunities:");
for optimization in perf_analysis.optimization_opportunities {
    println(f"‚Ä¢ {optimization}");
}
</code></pre>
<h2 id="notebook-integration"><a class="header" href="#notebook-integration">Notebook Integration</a></h2>
<h3 id="jupyter-integration-pattern"><a class="header" href="#jupyter-integration-pattern">Jupyter Integration Pattern</a></h3>
<pre><code class="language-ruchy">// Framework for integrating WASM analysis with Jupyter notebooks
struct NotebookIntegration {
    kernel_type: String,
    analysis_endpoint: String,
    supported_formats: Vec&lt;String&gt;
}

fun setup_jupyter_wasm_analysis() -&gt; NotebookIntegration {
    NotebookIntegration {
        kernel_type: "ruchy".to_string(),
        analysis_endpoint: "http://localhost:8080/api/analysis".to_string(),
        supported_formats: vec!["wasm".to_string(), "wat".to_string(), "as".to_string()]
    }
}

// Example notebook cell integration
fun notebook_analyze_wasm(file_path: String) -&gt; String {
    let analysis = analyze_wasm_binary(file_path);
    let security = analyze_wasm_security(analysis);
    let performance = analyze_wasm_performance(analysis);
    
    // Format for notebook display
    format_notebook_output(analysis, security, performance)
}

fun format_notebook_output(
    metrics: WasmMetrics,
    security: Vec&lt;WasmSecurityCheck&gt;,
    performance: WasmPerformanceMetrics
) -&gt; String {
    let mut output = String::new();
    
    output.push_str("## WASM Analysis Report\n\n");
    
    // Metrics section
    output.push_str("### Module Metrics\n");
    output.push_str(&amp;format!("- **Size**: {:.1}KB\n", metrics.file_size_kb));
    output.push_str(&amp;format!("- **Functions**: {}\n", metrics.function_count));
    output.push_str(&amp;format!("- **Memory**: {} pages ({:.0}KB)\n", 
        metrics.linear_memory_pages, metrics.linear_memory_pages * 64));
    
    // Security section
    output.push_str("\n### Security Status\n");
    let passed_checks = security.iter().filter(|c| c.passed).count();
    output.push_str(&amp;format!("- **Passed**: {}/{} security checks\n", 
        passed_checks, security.len()));
    
    // Performance section
    output.push_str("\n### Performance Metrics\n");
    output.push_str(&amp;format!("- **Load time**: {:.1}ms\n", performance.estimated_load_time_ms));
    output.push_str(&amp;format!("- **Compilation**: {}\n", performance.compilation_complexity));
    
    output
}

// Demo notebook integration
let integration = setup_jupyter_wasm_analysis();
println("Jupyter WASM Analysis Integration:");
println(f"‚Ä¢ Kernel: {integration.kernel_type}");
println(f"‚Ä¢ Endpoint: {integration.analysis_endpoint}");
println("‚Ä¢ Supported formats:");
for format in integration.supported_formats {
    println(f"  - {format}");
}
</code></pre>
<h3 id="observable-notebooks-integration"><a class="header" href="#observable-notebooks-integration">Observable Notebooks Integration</a></h3>
<pre><code class="language-ruchy">// Integration with Observable notebooks for interactive WASM analysis
fun create_observable_integration() -&gt; String {
    // JavaScript code for Observable notebook cells
    let observable_code = `
// WASM Analysis Observable Cell
{
  const wasmAnalyzer = {
    async analyzeModule(wasmBytes) {
      const module = new WebAssembly.Module(wasmBytes);
      const imports = WebAssembly.Module.imports(module);
      const exports = WebAssembly.Module.exports(module);
      
      return {
        imports: imports.length,
        exports: exports.length,
        importNames: imports.map(i =&gt; i.name),
        exportNames: exports.map(e =&gt; e.name)
      };
    },
    
    async fetchAndAnalyze(url) {
      const response = await fetch(url);
      const wasmBytes = await response.arrayBuffer();
      return this.analyzeModule(wasmBytes);
    }
  };
  
  return wasmAnalyzer;
}

// Usage in Observable cell:
// analysis = wasmAnalyzer.fetchAndAnalyze('path/to/module.wasm')
`;

    observable_code.to_string()
}

println("Observable Notebook Integration:");
println("Copy this JavaScript code into an Observable notebook:");
println("```javascript");
println(&amp;create_observable_integration());
println("```");
</code></pre>
<h2 id="advanced-analysis-techniques"><a class="header" href="#advanced-analysis-techniques">Advanced Analysis Techniques</a></h2>
<h3 id="wat-webassembly-text-analysis"><a class="header" href="#wat-webassembly-text-analysis">WAT (WebAssembly Text) Analysis</a></h3>
<pre><code class="language-ruchy">// Parsing and analyzing WAT format
fun analyze_wat_code(wat_content: String) -&gt; WatAnalysis {
    // Simplified WAT parsing (production would use proper parser)
    let lines = wat_content.split('\n').collect::&lt;Vec&lt;_&gt;&gt;();
    let mut analysis = WatAnalysis {
        functions: 0,
        locals: 0,
        instructions: 0,
        control_structures: 0,
        memory_operations: 0
    };
    
    for line in lines {
        let line = line.trim();
        if line.starts_with("(func") {
            analysis.functions += 1;
        } else if line.contains("local.get") || line.contains("local.set") {
            analysis.locals += 1;
        } else if line.starts_with("(if") || line.starts_with("(loop") || line.starts_with("(block") {
            analysis.control_structures += 1;
        } else if line.contains("memory.") {
            analysis.memory_operations += 1;
        }
        
        // Count total instructions (very simplified)
        if !line.starts_with("(") &amp;&amp; !line.is_empty() {
            analysis.instructions += 1;
        }
    }
    
    analysis
}

struct WatAnalysis {
    functions: u32,
    locals: u32,
    instructions: u32,
    control_structures: u32,
    memory_operations: u32
}

// Example WAT analysis
let sample_wat = `
(module
  (func $add (param $lhs i32) (param $rhs i32) (result i32)
    local.get $lhs
    local.get $rhs
    i32.add)
  (func $fibonacci (param $n i32) (result i32)
    (local $a i32)
    (local $b i32)
    (local $temp i32)
    i32.const 0
    local.set $a
    i32.const 1
    local.set $b
    (block
      (loop
        local.get $n
        i32.const 1
        i32.le_s
        br_if 1
        local.get $a
        local.get $b
        i32.add
        local.set $temp
        local.get $b
        local.set $a
        local.get $temp
        local.set $b
        local.get $n
        i32.const 1
        i32.sub
        local.set $n
        br 0)))
  (export "add" (func $add))
  (export "fibonacci" (func $fibonacci)))`;

let wat_analysis = analyze_wat_code(sample_wat);

println("WAT Analysis Results:");
println(f"‚Ä¢ Functions: {wat_analysis.functions}");
println(f"‚Ä¢ Local operations: {wat_analysis.locals}");
println(f"‚Ä¢ Instructions: {wat_analysis.instructions}");
println(f"‚Ä¢ Control structures: {wat_analysis.control_structures}");
println(f"‚Ä¢ Memory operations: {wat_analysis.memory_operations}");
</code></pre>
<h2 id="quality-grading-system"><a class="header" href="#quality-grading-system">Quality Grading System</a></h2>
<pre><code class="language-ruchy">// Comprehensive WASM module quality grading
fun grade_wasm_module(
    metrics: WasmMetrics,
    security: Vec&lt;WasmSecurityCheck&gt;,
    performance: WasmPerformanceMetrics
) -&gt; WasmQualityGrade {
    let mut total_score = 100.0;
    let mut deductions = Vec::new();
    
    // Security score (40% weight)
    let security_passed = security.iter().filter(|c| c.passed).count();
    let security_score = (security_passed as f64 / security.len() as f64) * 40.0;
    total_score = total_score - (40.0 - security_score);
    
    if security_score &lt; 40.0 {
        deductions.push(format!("Security: -{:.1} points", 40.0 - security_score));
    }
    
    // Performance score (35% weight)
    let mut performance_score = 35.0;
    if performance.estimated_load_time_ms &gt; 100.0 {
        performance_score -= 10.0;
        deductions.push("Performance: Large load time -10 points".to_string());
    }
    if performance.compilation_complexity == "High" {
        performance_score -= 10.0;
        deductions.push("Performance: High compilation complexity -10 points".to_string());
    }
    if performance.memory_efficiency &lt; 1.0 {
        performance_score -= 5.0;
        deductions.push("Performance: Poor memory efficiency -5 points".to_string());
    }
    
    total_score = total_score - (35.0 - performance_score);
    
    // Structure score (25% weight)
    let mut structure_score = 25.0;
    if metrics.function_count &gt; 100 {
        structure_score -= 5.0;
        deductions.push("Structure: Too many functions -5 points".to_string());
    }
    if metrics.export_count &gt; 20 {
        structure_score -= 5.0;
        deductions.push("Structure: Large export surface -5 points".to_string());
    }
    if metrics.linear_memory_pages &gt; 10 {
        structure_score -= 5.0;
        deductions.push("Structure: Excessive memory usage -5 points".to_string());
    }
    
    total_score = total_score - (25.0 - structure_score);
    
    // Determine letter grade
    let letter_grade = if total_score &gt;= 95.0 {
        "A+"
    } else if total_score &gt;= 90.0 {
        "A"
    } else if total_score &gt;= 85.0 {
        "A-"
    } else if total_score &gt;= 80.0 {
        "B+"
    } else if total_score &gt;= 75.0 {
        "B"
    } else if total_score &gt;= 70.0 {
        "B-"
    } else if total_score &gt;= 65.0 {
        "C+"
    } else if total_score &gt;= 60.0 {
        "C"
    } else {
        "F"
    };
    
    WasmQualityGrade {
        total_score,
        letter_grade: letter_grade.to_string(),
        deductions,
        security_score,
        performance_score,
        structure_score
    }
}

struct WasmQualityGrade {
    total_score: f64,
    letter_grade: String,
    deductions: Vec&lt;String&gt;,
    security_score: f64,
    performance_score: f64,
    structure_score: f64
}

// Grade our sample module
let quality_grade = grade_wasm_module(sample_metrics, security_results, perf_analysis);

println("WASM Module Quality Grade:");
println(f"üéØ **Overall Grade**: {quality_grade.letter_grade} ({quality_grade.total_score:.1}/100)");
println(f"\nüìä **Component Scores**:");
println(f"‚Ä¢ Security: {quality_grade.security_score:.1}/40");
println(f"‚Ä¢ Performance: {quality_grade.performance_score:.1}/35");  
println(f"‚Ä¢ Structure: {quality_grade.structure_score:.1}/25");

if !quality_grade.deductions.is_empty() {
    println(f"\n‚ö†Ô∏è  **Deductions**:");
    for deduction in quality_grade.deductions {
        println(f"‚Ä¢ {deduction}");
    }
}
</code></pre>
<h2 id="industry-integration-patterns"><a class="header" href="#industry-integration-patterns">Industry Integration Patterns</a></h2>
<pre><code class="language-ruchy">// Real-world WASM analysis integration patterns
println("üè≠ Industry Integration Patterns:");

println("\n**1. CI/CD Pipeline Integration:**");
println("‚Ä¢ Automated WASM quality checks in build process");
println("‚Ä¢ Security validation before deployment");
println("‚Ä¢ Performance regression detection");

println("\n**2. Development Environment Integration:**");
println("‚Ä¢ IDE plugins for real-time WASM analysis");
println("‚Ä¢ VS Code extensions with quality indicators");
println("‚Ä¢ IntelliJ IDEA integration for AssemblyScript");

println("\n**3. Production Monitoring:**");
println("‚Ä¢ Runtime performance monitoring");
println("‚Ä¢ Security incident detection");
println("‚Ä¢ Memory usage tracking and alerting");

println("\n**4. Notebook Computing:**");
println("‚Ä¢ Jupyter kernels with WASM support");
println("‚Ä¢ Observable notebooks for interactive analysis");
println("‚Ä¢ Colab integration for ML workloads");
</code></pre>
<h2 id="key-insights"><a class="header" href="#key-insights">Key Insights</a></h2>
<ol>
<li><strong>Comprehensive Analysis</strong>: WASM modules require multi-dimensional analysis covering security, performance, and structure</li>
<li><strong>Security First</strong>: Memory safety and import validation are critical for production deployment</li>
<li><strong>Performance Impact</strong>: Load time and compilation complexity directly affect user experience</li>
<li><strong>Notebook Integration</strong>: Interactive analysis environments enable rapid prototyping and exploration</li>
<li><strong>Quality Grading</strong>: Systematic scoring helps maintain code quality standards</li>
</ol>
<h2 id="next-steps"><a class="header" href="#next-steps">Next Steps</a></h2>
<ul>
<li>Explore <a href="ch09-02-wasm-profiling.html">advanced profiling techniques</a></li>
<li>Learn about <a href="ch09-03-wasm-deployment.html">WASM deployment patterns</a></li>
<li>Master <a href="ch09-04-wasm-integration.html">cross-platform integration</a></li>
</ul>
<hr />
<p><strong>Complete Demo File:</strong> <a href="../../demos/repl/09-wasm-analysis/wasm_analysis_demo.ruchy"><code>wasm_analysis_demo.ruchy</code></a></p>
<p><em>Every code snippet is tested and verified working. Copy-paste directly into your Ruchy REPL or notebook environment.</em></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="ch08-04-correlation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="ch09-00-file-operations-tdd.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="ch08-04-correlation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="ch09-00-file-operations-tdd.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="ace.js"></script>
        <script src="mode-rust.js"></script>
        <script src="editor.js"></script>
        <script src="theme-dawn.js"></script>
        <script src="theme-tomorrow_night.js"></script>

        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="book/theme/highlight-ruchy.js"></script>



    </div>
    </body>
</html>
